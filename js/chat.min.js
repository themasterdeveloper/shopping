"use strict";var chat={data:{lastID:0},url:"/ws/br.php",DATE_ROW:'<div class="row"><div class="col-lg-12"><p class="text-center text-muted small">{sent}</p></div></div>',MESSAGE_ROW:'<div class="row"><div class="col-lg-12"><div class="media-body"><h4 class="media-heading">{name}<span class="small pull-right">{time}</span></h4><div class="media"><a class="pull-{align}" href="#"><img class="media-object img-circle" src="{image}" alt=""></a><p>{message}</p></div></div></div></div>',init:function(){$.ajaxSetup({url:chat.url})},get_messages:function(){var c=cookies.getCookie("order_id");if(!c){return}var a=cookies.getCookie("sender");if(!a){return}var b={action:"get_messages",order_id:c,lastID:chat.data.lastID};common.log("get_messages",b);$.ajax({data:b,success:function(f){common.log("get_messages",f);if(f.length>0&&!f[0].error){var g=[],h=0,k="";for(var d=0;d<f.length;d++){var j=f[d];chat.data.lastID=j.id;var e=chat.DATE_ROW;var l=chat.MESSAGE_ROW;if(k!=j.sent){k=j.sent;g[h]=e.replace("{sent}",k);h++}for(var m in j){var n=parseInt(j.sender);if(n==a&&m=="name"){l=l.replace("{"+m+"}","")}l=l.replace("{"+m+"}",j[m])}if(n==a){l=l.replace("{align}","right");$(".user-name").html(j.name)}else{l=l.replace("{align}","left")}g[h]=l;h++}$(".chat-widget").append(g.join(""));$(".chat-widget").animate({scrollTop:$(".chat-widget")[0].scrollHeight},800);if(a==2){chat.mark_as_read(c)}}setTimeout(function(){chat.get_messages()},5000)}})},check_messages:function(){var b=cookies.getCookie("order_id");if(!b){$(".alerts-button").addClass("hidden");return}var a={action:"check_messages",order_id:b,lastID:chat.data.lastID};common.log("get_messages",a);$.ajax({data:a,success:function(d){common.log("check_messages",d);var c=d[0].undread;if(c==0){$(".unread-messsages").html("");$(".alerts-button").removeClass("btn-danger").addClass("btn-info");$(".unread-messsages").addClass("hidden")}else{$(".unread-messsages").html(c);$(".alerts-button").removeClass("btn-info").addClass("btn-danger");$(".unread-messsages").removeClass("hidden");Push.create("Hi there!",{body:"You've got a message from iyabasira.online",icon:"img/rsz_new_message.png",timeout:8000,vibrate:[100,100,100],onClick:function(){Push.clear();$(".alerts-button").click()}})}$(".alerts-button").removeClass("hidden");setTimeout(function(){chat.check_messages()},20000)}})},mark_as_read:function(b){var a={action:"mark_as_read",order_id:b};common.log("mark_as_read",a);$.ajax({data:a,success:function(c){common.log("mark_as_read",c)}})},send_message:function(b){var d=cookies.getCookie("order_id");if(!d){return}var a=cookies.getCookie("sender");if(!a){return}if(!b){return}var c={action:"send_message",order_id:d,sender_type:a,message:b};common.log("send_message",c);$.ajax({data:c,success:function(e){common.log("send_message",e);$("#chat-message").val("")}})},get_latest_messages:function(){var a={action:"get_latest_messages"};common.log("get_latest_messages",a);$.ajax({data:a,success:function(e){common.log("get_latest_messages",e);if(e.length>0&&!e[0].error){var c=[];var b=0;c[b]='<ul class="nav nav-tabs">';b++;for(var d=0;d<e.length;d++){var f=e[d];c[b]='<li class="message-option"><a href="javascript:void(0)" onclick="open_chat_room('+f.order_id+')">'+f.number+'<br><span class="message-sent">'+f.sent+"</span></a></li>";b++}c[b]="</ul>";$(".data").empty().append(c.join(""));setTimeout(function(){chat.get_latest_messages()},30000)}}})}};