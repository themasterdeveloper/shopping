var webservice_path="/ws/br.php";var DATE_ROW='<div class="row"><div class="col-lg-12"><p class="text-center text-muted small">{sent}</p></div></div>';var MESSAGE_ROW='<div class="row"><div class="col-lg-12"><div class="media-body"><h4 class="media-heading">{name}<span class="small pull-right">{time}</span></h4><div class="media"><a class="pull-{align}" href="#"><img class="media-object img-circle" src="{image}" alt=""></a><p>{message}</p></div></div></div></div>';$.ajaxSetup({url:webservice_path});var get_messages=function(){var c=getCookie("order_id");if(!c){return}var a=getCookie("sender");if(!a){return}var b={};b.action="get_messages";b.order_id=c;log("get_messages",b);$.ajax({data:b,success:function(l){log("get_messages",l);if(l.length>0&&!l[0].error){var g=[];var f=0;var k="";for(var h=0;h<l.length;h++){$this=l[h];var j=DATE_ROW;var e=MESSAGE_ROW;if(k!=$this.sent){k=$this.sent;g[f]=j.replace("{sent}",k);f++}for(key in $this){var d=parseInt($this.sender);if(d==a&&key=="name"){e=e.replace("{"+key+"}","")}e=e.replace("{"+key+"}",$this[key])}if(d==a){e=e.replace("{align}","right");$(".user-name").html($this.name)}else{e=e.replace("{align}","left")}g[f]=e;f++}$(".chat-widget").empty().append(g.join(""));$(".chat-widget").animate({scrollTop:$(".chat-widget")[0].scrollHeight},800);if(a==2){mark_as_read(c)}setTimeout(function(){get_messages()},5000)}}})};var check_messages=function(){var b=getCookie("order_id");if(!b){$(".alerts-button").addClass("hidden");return}var a={};a.action="check_messages";a.order_id=b;log("get_messages",a);$.ajax({data:a,success:function(d){log("check_messages",d);var c=d[0].undread;if(c==0){$(".unread-messsages").html("");$(".alerts-button").removeClass("btn-danger").addClass("btn-info");$(".unread-messsages").addClass("hidden")}else{$(".unread-messsages").html(c);$(".alerts-button").removeClass("btn-info").addClass("btn-danger");$(".unread-messsages").removeClass("hidden")}$(".alerts-button").removeClass("hidden");setTimeout(function(){check_messages()},20000)}})};var mark_as_read=function(b){var a={};a.action="mark_as_read";a.order_id=b;log("mark_as_read",a);$.ajax({data:a,success:function(c){log("mark_as_read",c)}})};var send_message=function(b){var d=getCookie("order_id");if(!d){return}var a=getCookie("sender");if(!a){return}if(!b){return}var c={};c.action="send_message";c.order_id=d;c.sender_type=a;c.message=b;log("send_message",c);$.ajax({data:c,success:function(e){log("send_message",e);$("#chat-message").val("")}})};