window.onerror=function(c,a,b){log("JavaScript error: "+c+" on line "+b+" for "+a)};var d="d="+new Date().toJSON();var webservice_path="/ws/br.php";var DATE_ROW='<div class="row"><div class="col-lg-12"><p class="text-center text-muted small">{sent}</p></div></div>';var MESSAGE_ROW='<div class="row"><div class="col-lg-12"><div class="media-body"><h4 class="media-heading">{name}<span class="small pull-right">{time}</span></h4><div class="media"><a class="pull-{align}" href="#"><img class="media-object img-circle" src="{image}" alt=""></a><p>{message}</p></div></div></div></div>';setCookie=function(e,c,a){var f=new Date();a=365;f.setDate(f.getDate()+a);var b=escape(c)+((a==null)?"":";path=/;expires="+f.toUTCString());document.cookie=e+"="+b};getCookie=function(c){var b=document.cookie;var e=b.indexOf(" "+c+"=");if(e==-1){e=b.indexOf(c+"=")}if(e==-1){b=null}else{e=b.indexOf("=",e)+1;var a=b.indexOf(";",e);if(a==-1){a=b.length}b=unescape(b.substring(e,a))}return b};deleteAllCookies=function(){var e=document.cookie.split(";");for(var c=0;c<e.length;c++){var b=e[c];var f=b.indexOf("=");var a=f>-1?b.substr(0,f):b;document.cookie=a+"=;path=/;expires=Thu, 01 Jan 1970 00:00:00 GMT"}};function listCookies(){var a=document.cookie.split(";");var g={};for(var c=0;c<a.length;c++){var e=a[c].split("=");var b=e[0].replace(/^ /,"");var f=e[1];if(g[b]!==undefined){if(!g[b].push){g[b]=[g[b]]}g[b].push(f||"")}else{g[b]=f||""}}return g}var log=function(a,b){if(getCookie("Debug")=="True"){if(b===undefined){console.log(a)}else{console.debug(a,b)}}};jQuery.fn.center=function(){this.css("position","absolute");this.css("top",Math.max(0,(($(window).height()-$(this).outerHeight())/3)+$(window).scrollTop())+"px");this.css("left",Math.max(0,(($(window).width()-$(this).outerWidth())/2)+$(window).scrollLeft())+"px");return this};$.ajaxSetup({type:"GET",url:webservice_path,contentType:"application/json; charset=utf-8",dataType:"json",cache:true,async:true,timeout:0,error:function(b,a){log_ajax_error(b,a)}});log_ajax_error=function(b,a){log("xhr",b);showErr("We are sorry, but there was an error accessing the database")};$(document).ajaxStart(function(){$(".fa").show().center()});$(document).ajaxStop(function(){$(".fa").fadeOut("slow")});$(document).ajaxError(function(){setTimeout(function(){$(".fa").fadeOut("slow")},3000)});showMsg=function(a){$(".alert").removeClass("alert-danger").removeClass("alert-info").addClass("alert-info");$(".alert #msg").html(a);$(".alert").show()};showErr=function(a){$(".alert").removeClass("alert-info").removeClass("alert-danger").addClass("alert-danger");$(".alert #msg").html(a);$(".alert").show()};var get_messages=function(){var b=getCookie("order_id");if(!b){return}var a={};a.action="get_messages";a.order_id=b;log("get_messages",a);$.ajax({data:a,success:function(k){log("get_messages",k);if(k.length>0&&!k[0].error){var f=[];var e=0;var j="";for(var g=0;g<k.length;g++){$this=k[g];var h=DATE_ROW;var c=MESSAGE_ROW;if(j!=$this.sent){j=$this.sent;f[e]=h.replace("{sent}",j);e++}for(key in $this){if($this.sender==2&&key=="name"){c=c.replace("{"+key+"}","")}c=c.replace("{"+key+"}",$this[key])}if(getCookie("token")){if($this.sender==2){c=c.replace("{align}","right");$(".user-name").html($this.name)}else{c=c.replace("{align}","left")}}f[e]=c;e++}$(".chat-widget").empty().append(f.join(""))}}})};var send_message=function(a){var c=getCookie("order_id");if(!c){return}if(!a){return}var b={};b.action="send_message";b.order_id=c;b.message=a;log("send_message",b);$.ajax({data:b,success:function(e){log("send_message",e);$("#chat-message").val("");get_messages()}})};