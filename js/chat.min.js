window.onerror=function(c,a,b){log("JavaScript error: "+c+" on line "+b+" for "+a)};var d="d="+new Date().toJSON();var webservice_path="/ws/br.php";var DATE_ROW='<div class="row"><div class="col-lg-12"><p class="text-center text-muted small">{sent}</p></div></div>';var MESSAGE_ROW='<div class="row"><div class="col-lg-12"><div class="media-body"><h4 class="media-heading">{name}<span class="small pull-right">{time}</span></h4><div class="media"><a class="pull-{align}" href="#"><img class="media-object img-circle" src="{image}" alt=""></a><p>{message}</p></div></div></div></div>';var log=function(a,b){if(getCookie("Debug")=="True"){if(b===undefined){console.log(a)}else{console.debug(a,b)}}};jQuery.fn.center=function(){this.css("position","absolute");this.css("top",Math.max(0,(($(window).height()-$(this).outerHeight())/3)+$(window).scrollTop())+"px");this.css("left",Math.max(0,(($(window).width()-$(this).outerWidth())/2)+$(window).scrollLeft())+"px");return this};$.ajaxSetup({type:"GET",url:webservice_path,contentType:"application/json; charset=utf-8",dataType:"json",cache:true,async:true,timeout:0,error:function(b,a){log_ajax_error(b,a)}});log_ajax_error=function(b,a){log("xhr",b);showErr("We are sorry, but there was an error accessing the database")};showMsg=function(a){$(".alert").removeClass("alert-danger").removeClass("alert-info").addClass("alert-info");$(".alert #msg").html(a);$(".alert").show()};showErr=function(a){$(".alert").removeClass("alert-info").removeClass("alert-danger").addClass("alert-danger");$(".alert #msg").html(a);$(".alert").show()};var get_messages=function(){var c=getCookie("order_id");if(!c){return}var a=getCookie("sender");if(!a){return}var b={};b.action="get_messages";b.order_id=c;log("get_messages",b);$.ajax({data:b,success:function(m){log("get_messages",m);if(m.length>0&&!m[0].error){var h=[];var g=0;var l="";for(var j=0;j<m.length;j++){$this=m[j];var k=DATE_ROW;var f=MESSAGE_ROW;if(l!=$this.sent){l=$this.sent;h[g]=k.replace("{sent}",l);g++}for(key in $this){var e=parseInt($this.sender);if(e==a&&key=="name"){f=f.replace("{"+key+"}","")}f=f.replace("{"+key+"}",$this[key])}if(e==a){f=f.replace("{align}","right");$(".user-name").html($this.name)}else{f=f.replace("{align}","left")}h[g]=f;g++}$(".chat-widget").empty().append(h.join(""));$(".chat-widget").animate({scrollTop:$(".chat-widget")[0].scrollHeight},800);if(a==2){mark_as_read(c)}setTimeout(function(){get_messages()},5000)}}})};var check_messages=function(){var b=getCookie("order_id");if(!b){$(".alerts-button").addClass("hidden");return}var a={};a.action="check_messages";a.order_id=b;log("get_messages",a);$.ajax({data:a,success:function(e){log("check_messages",e);var c=e[0].undread;if(c==0){$(".unread-messsages").html("");$(".alerts-button").removeClass("btn-danger").addClass("btn-info");$(".unread-messsages").addClass("hidden")}else{$(".unread-messsages").html(c);$(".alerts-button").removeClass("btn-info").addClass("btn-danger");$(".unread-messsages").removeClass("hidden")}$(".alerts-button").removeClass("hidden");setTimeout(function(){check_messages()},20000)}})};var mark_as_read=function(b){var a={};a.action="mark_as_read";a.order_id=b;log("mark_as_read",a);$.ajax({data:a,success:function(c){log("mark_as_read",c)}})};var send_message=function(b){var e=getCookie("order_id");if(!e){return}var a=getCookie("sender");if(!a){return}if(!b){return}var c={};c.action="send_message";c.order_id=e;c.sender_type=a;c.message=b;log("send_message",c);$.ajax({data:c,success:function(f){log("send_message",f);$("#chat-message").val("")}})};