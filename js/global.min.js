window.onerror=function(c,a,b){log("JavaScript error: "+c+" on line "+b+" for "+a)};var d="d="+new Date().toJSON();var webservice_path="/ws/br.php",record_id,cur_page=0;token="",error=false,intro=false,HOME="/home.html",sms_url="https://www.bulksmsnigeria.net/components/com_spc/smsapi.php",sms_user="nwabuezestephen27@gmail.com",sms_password="Foot27ball",sms_sender="iyabasira";var log=function(a,b){if(getCookie("Debug")=="True"){console.debug(a,b)}};setCookie=function(e,c,a){var f=new Date();f.setDate(f.getDate()+a);var b=escape(c)+((a==null)?"":";path=/;expires="+f.toUTCString());document.cookie=e+"="+b};getCookie=function(c){var b=document.cookie;var e=b.indexOf(" "+c+"=");if(e==-1){e=b.indexOf(c+"=")}if(e==-1){b=null}else{e=b.indexOf("=",e)+1;var a=b.indexOf(";",e);if(a==-1){a=b.length}b=unescape(b.substring(e,a))}return b};deleteAllCookies=function(){var e=document.cookie.split(";");for(var c=0;c<e.length;c++){var b=e[c];var f=b.indexOf("=");var a=f>-1?b.substr(0,f):b;document.cookie=a+"=;path=/;expires=Thu, 01 Jan 1970 00:00:00 GMT"}};showMsg=function(a){$(".alert").removeClass("alert-danger").removeClass("alert-info").addClass("alert-info");$(".alert #msg").html(a);$(".alert").show()};showErr=function(a){$(".alert").removeClass("alert-info").removeClass("alert-danger").addClass("alert-danger");$(".alert #msg").html(a);$(".alert").show()};pad=function(b,a){b=String(b);a=a||2;while(b.length<a){b="0"+b}return b};jQuery.fn.center=function(){this.css("position","absolute");this.css("top",Math.max(0,(($(window).height()-$(this).outerHeight())/3)+$(window).scrollTop())+"px");this.css("left",Math.max(0,(($(window).width()-$(this).outerWidth())/2)+$(window).scrollLeft())+"px");return this};$.fn.serializeObject=function(){var c={};var b=this.serializeArray();$.each(b,function(){if(c[this.name]!==undefined){if(!c[this.name].push){c[this.name]=[c[this.name]]}c[this.name].push(this.value||"")}else{c[this.name]=this.value||""}});return c};function GetParameterValues(e){var a=window.location.href.slice(window.location.href.indexOf("?")+1).split("&");for(var b=0;b<a.length;b++){var c=a[b].split("=");if(c[0]==e){return c[1]}}}function toggleFullScreen(){if(!document.fullscreenElement&&!document.mozFullScreenElement&&!document.webkitFullscreenElement&&!document.msFullscreenElement){if(document.documentElement.requestFullscreen){document.documentElement.requestFullscreen()}else{if(document.documentElement.msRequestFullscreen){document.documentElement.msRequestFullscreen()}else{if(document.documentElement.mozRequestFullScreen){document.documentElement.mozRequestFullScreen()}else{if(document.documentElement.webkitRequestFullscreen){document.documentElement.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT)}}}}}else{if(document.exitFullscreen){document.exitFullscreen()}else{if(document.msExitFullscreen){document.msExitFullscreen()}else{if(document.mozCancelFullScreen){document.mozCancelFullScreen()}else{if(document.webkitExitFullscreen){document.webkitExitFullscreen()}}}}}}$.ajaxSetup({type:"GET",url:webservice_path,contentType:"application/json; charset=utf-8",dataType:"json",cache:true,async:true,timeout:0,error:function(b,a){log_ajax_error(b,a)}});$(document).ajaxStart(function(){$(".fa").show().center()});$(document).ajaxStop(function(){$(".fa").fadeOut("slow")});$(document).ajaxError(function(){setTimeout(function(){$(".fa").fadeOut("slow")},3000)});log_ajax_error=function(b,a){log(b);showErr("We are sorry, but there was an error accessing the database")};validate_form=function(e){$(".alert").hide();var a=e.length;var b="";error=false;for(var c=0;c<a;c++){b=e[c].name;if(b!=""){validate_field(b)}}if(error){showErr("Some errors were found. Please correct them and try again")}else{save_ticket()}};validate_field=function(b){var a="#"+b;var c="#"+b+"1";if($(a).val()==""){$(a).closest(".form-group").removeClass("has-success has-feedback").addClass("has-error has-feedback");$(c).removeClass("glyphicon-ok").addClass("glyphicon-remove");error=true}else{$(a).closest(".form-group").removeClass("has-error has-feedback").addClass("has-success has-feedback");$(c).removeClass("glyphicon-remove").addClass("glyphicon-ok")}};load_products=function(){if(token.length==0){get_token()}$(".area-message").addClass("hidden");var a={};a.action="products_search";a.search=$("#search_text").val();a.token=getCookie("token");a.area_id=getCookie("chosen-area");a.shop_area_id=getCookie("shop-area-id");log("load_products",a);$(".alert").hide();$.ajax({data:a,success:function(h){log("load_products",h);if(h[0].error==1){$("#dashboard-table").empty();showErr(h[0].message);return false}var b=h.length;var f=[],e=0;var g="-total_rows-";for(r=0;r<b;r++){$this=h[r];f[e]="<div class='list-group'>";e++;for(var c in $this){if(g.indexOf("-"+c+"-")==-1){f[e]="<div href='#' class='list-group-item it-"+$this.id+"'>";if($this.logo!=""){f[e]+="<img src='/img/"+$this.logo+"' class='shop-logo'>"}f[e]+="<span class='area'>"+$this.area+"</span>";f[e]+="<span class='product'>"+$this.product+"</span><br/>";if($this.image==""){f[e]+="<img class='product-image' src='/img/no-image.jpg'>"}else{f[e]+="<img class='product-image' src='/img/"+$this.image+"'>"}f[e]+="<span class='price'>"+$this.price+"</span>";f[e]+="<button class='buy-product-button btn btn-success btn-lg' onclick=buy_product("+$this.id+") >ORDER NOW</button>";f[e]+="</div>"}}f[e]+="</div>";e++}$("#dashboard-table").empty().append(f.join("")).show();$(".table-responsive").show();$(".search-box").show();if(navigator.geolocation){navigator.geolocation.getCurrentPosition(function(j){var k={lat:j.coords.latitude,lng:j.coords.longitude};save_location(k)})}}});updateBasket();log("listCookies",listCookies())};get_token=function(){if(getCookie("token")){token=getCookie("token");$("#token").val(token);return}var a={};a.action="get_token";a.area_id=getCookie("chosen-area");log("get_token",a);$.ajax({data:a,success:function(b){log("get_token",b);token=b[0].token;$("#token").val(token);setCookie("token",token)}})};buy_product=function(b){var a="it-"+b;var c=$("."+a).position();$("#quantity").val(1);$(".order-form").css("top",c.top+32).show();$(".order-form #product_id").val(b);$(".shadow").show();event.preventDefault()};add_product=function(){var a={};a.action="save_item";a.token=token;a.product_id=$("#product_id").val();a.quantity=$("#quantity").val();log("add_product",a);$.ajax({data:a,success:function(c){log("add_product",c);var b=c[0];if(b.error==0){$(".order-form").hide();$(".shadow").hide()}else{if(b.error==2){resetToken()}$(".error_message").html(b.message).show()}updateBasket();load_products()}})};updateBasket=function(){var a={};a.action="get_total_basket";a.token=getCookie("token");log("updateBasket",a);$.ajax({data:a,success:function(e){log("updateBasket",e);var c=e[0];var b=c.grand_total;$(".basket").html(b);setCookie("total_basket",c.total_basket);setCookie("total_fees",c.total_fees);setCookie("delivery_fees",c.delivery_fees);setCookie("grand_total",c.grand_total);if(parseFloat(b)>0){$(".basket").parent().removeClass("hidden")}else{$(".basket").parent().addClass("hidden")}}})};function listCookies(){var a=document.cookie.split(";");var g={};for(var c=0;c<a.length;c++){var e=a[c].split("=");var b=e[0].replace(/^ /,"");var f=e[1];if(g[b]!==undefined){if(!g[b].push){g[b]=[g[b]]}g[b].push(f||"")}else{g[b]=f||""}}return g}load_basket_products=function(){var a={};user_id=0;a.action="basket_list";a.token=getCookie("token");log("load_basket_products",a);updateBasket();$.ajax({data:a,success:function(h){log("load_basket_products",h);if(h[0].error==1){$("#content").load(HOME);return}var f=[],j=[],e=0;var g="-id-area-";j[e]="<tr>";$this=h[0];for(var c in $this){if(g.indexOf("-"+c+"-")==-1){j[e]="<th class='__"+c+"'>"+c+"</th>";e++}}j[e]="</tr>";e=0;var b=h.length;for(r=0;r<b;r++){$this=h[r];f[e]="<tr>";e++;for(var c in $this){if(g.indexOf("-"+c+"-")==-1){if(c=="shop"){f[e]="<td class='__"+c+"'>"+$this[c]+"<br>"+$this.area+"</td>"}else{f[e]="<td class='__"+c+"'>"+$this[c]+"</td>"}e++}}f[e]="<td><a href='#' onclick=removeItem("+$this.id+")><span class='glyphicon glyphicon-remove'></span></td></a></tr>";e++}$("#basket-table thead").empty().append(j.join(""));$("#basket-table tbody").empty().append(f.join(""));e=0;f.length=0;f[e]="<tr><td colspan=3  class='_amount _top_line'>TOTAL BASKET</td><td class='_amount _top_line'>"+getCookie("total_basket")+"</td><td  class='_top_line'></td></tr>";e++;f[e]="<tr><td colspan=3  class='_amount'>DELIVERY</td><td class='_amount'>"+getCookie("delivery_fees")+"</td><td></td></tr>";e++;f[e]="<tr><td colspan=3  class='_amount _grand_total'>TOTAL ORDER</td><td class='_amount  _grand_total'>"+getCookie("grand_total")+"</td><td class='_amount  _grand_total'></td></tr>";$("#basket-table tfoot").empty().append(f.join(""));$(".table-responsive").show()}})};removeItem=function(a){var b={};b.action="remove_item";b.item_id=a;log("removeItem",b);$.ajax({data:b,success:function(c){log("removeItem",c);load_basket_products()}})};removeAll=function(){var a={};a.action="remove_all";a.token=getCookie("token");log("removeAll",a);$.ajax({data:a,success:function(b){log("removeAll",b);load_basket_products()}})};resetToken=function(){token="";$("#token").val(token);deleteAllCookies();get_token()};get_areas=function(){var a={};a.action="get_areas";log("get_areas",a);$.ajax({data:a,success:function(b){log("get_areas",b);$(".areas-list").html(b[0].areas)}})};save_location=function(b){var a={};a.action="save_location";a.token=getCookie("token");a.lat=b.lat;a.lng=b.lng;log("save_location",a);$.ajax({data:a,success:function(c){log("save_location",c)},error:function(c){log("save_location.error",c)}})};load_dropdown=function(a,e,b){e=(typeof e==="undefined")?false:e;b=(typeof b==="undefined")?false:b;var c={};c.action=a+"_list";log("load_"+a,c);var f="Nothing selected";switch(a){case"areas":f="Select an area";break;case"category":f="Select a category";break}$.ajax({data:c,success:function(k){log("load_"+a,k);var j=[];var g=k.length;if(e==1){var h="<option></option>"}for(r=0;r<g;r++){$this=k[r];j[r]=h+"<option value="+$this.id+">"+$this.value+"</option>";h=""}$("."+a).html(j.join("")).selectpicker({noneSelectedText:f}).selectpicker("refresh");if(b){$("."+a).prop("disabled",true);$("."+a).selectpicker("refresh")}}})};var submitForm=function(a){var e=a+"_save";var b=a+"-form";var c={};c.action=e;c.token=getCookie("token");c.area_id=getCookie("chosen-area");$("#"+b).find(":input:not(button):not(reset)").each(function(){var f=$(this);if(f.attr("id")){c[f.attr("id")]=f.val().trim()}});log("submitForm",c);$.ajax({data:c,success:function(f){log("submitForm",f);if(f[0].error!=0){showErr(f[0].message)}else{showMsg(f[0].message);setCookie("order_id",f[0].order_id);$("#content").load("/geolocation")}}})};notify=function(b){var a={};a.action="order_notify";a.order_id=b;log("notify",a);$.ajax({data:a,success:function(c){log("notify",c)}})};get_config_value=function(a){var b={};b.action="get_config_value";b.name=a;log("get_config_value",b);$.ajax({data:b,dataType:"json",success:function(c){log("get_config_value",c);setCookie(a,c[0].value)}})};save_area_location=function(e,c,a){var b={};b.action="save_area_location";b.area_id=e;b.lat=c;b.lng=a;log("save_area_location",b);$.ajax({data:b,dataType:"json",success:function(f){log("save_area_location",f);if(f[0].error!=0){showErr(f[0].message)}else{showMsg(f[0].message)}}})};save_shop_location=function(f,b,e,a){var c={};c.action="save_shop_location";c.area_id=f;c.shop_id=b;c.lat=e;c.lng=a;log("save_shop_location",c);$.ajax({data:c,dataType:"json",success:function(g){log("save_shop_location",g);if(g[0].error!=0){showErr(g[0].message)}else{showMsg(g[0].message);update_markers()}}})};load_shops_locations=function(b){var a={};a.action="shops_locations_list";a.area_id=0;log("load_shops_locations",a);$.ajax({data:a,success:function(c){log("load_shops_locations",c);setMarkers(c,"shop","/img/rsz_fastfood-pin.png")}})};load_deliverers_locations=function(b){var a={};a.action="deliverers_list";log("deliverers_list",a);$.ajax({data:a,success:function(c){log("deliverers_list",c);setMarkers(c,"name","/img/fastfood-worker-24-255355.png")}})};setMarkers=function(e,g,f){for(var a=0;a<e.length;a++){var c=e[a];var b=new google.maps.LatLng(c.lat,c.lng);createMarker(b,g,f,c)}};createMarker=function(f,e,c,b){var a=new google.maps.Marker({position:f,map:map,title:b[e],icon:c});a.set("id",b.id);a.addListener("click",function(){$("#item_id").val(b.id);showMarkerData(b)});markers.push(a)};showMarkerData=function(e){var b="";$this=e[0];var c="-id-lat-lng-photo-available-";for(var a in e){if(c.indexOf("-"+a+"-")==-1){b+='<span class="_data-value">';b+=e[a];b+="</span></br>"}}$(".marker-data").html(b)};remove_markers=function(){for(i=0;i<markers.length;i++){markers[i].setMap(null)}};close_infowindows=function(){for(i=0;i<infowindows.length;i++){infowindows[i].close()}};relocateMap=function(){if(navigator.geolocation){navigator.geolocation.getCurrentPosition(function(a){lat=a.coords.latitude;lng=a.coords.longitude;initialLocation=new google.maps.LatLng(a.coords.latitude,a.coords.longitude);me_marker.setPosition(initialLocation)})}};adm_load_table=function(b,a){a=(typeof a==="undefined")?false:a;$(".table-name").html(b.replace("_"," / "));$(".alert").hide();if(getCookie("cur_page")){cur_page=parseInt(getCookie("cur_page"))}if(getCookie("rows_per_page")){rows_per_page=parseInt(getCookie("rows_per_page"))}var c={};c.action="adm_load_table_"+b;c.search=$("#search").val();c.limit=cur_page;c.rows=rows_per_page;log("load_table",c);$.ajax({data:c,success:function(f){log("load_table",f);if(f[0].error==1){$("#"+b+"-table tbody").empty();$("#"+b+"-table tbody").empty();$("#"+b+"-table tfood").empty();showErr(f[0].message);return false}var m="-id-active-total_records-";var e=f.length;var k=0;var g=[],h=0;$this=f[0];var p=$this.total_records;g[h]="<tr>";h++;for(var o in $this){if(m.indexOf("-"+o+"-")==-1){g[h]="<th class='__"+o+"'>"+o+"</th>";h++;k++}}if(!a){g[h]="<th></th>";h++}g[h]="</tr>";$("#"+b+"-table thead").empty().append(g.join(""));g=[];h=0;for(r=0;r<e;r++){$this=f[r];g[h]="<tr>";h++;for(var o in $this){if(m.indexOf("-"+o+"-")==-1){g[h]="<td class='__"+o+"'>"+$this[o]+"</td>";h++}}if(!a){g[h]='<td class="button-group">';h++;if($this.active==0){g[h]='<button class="btn btn-danger btn-sm delete-item" onclick="adm_delete_item('+$this.id+",'"+b+"')\">Delete</button>";h++}g[h]='<button class="btn btn-primary btn-sm edit-item" onclick="adm_edit_item('+$this.id+",'"+b+"')\">Edit</button>";h++;g[h]="</td>";h++}g[h]="</tr>";h++}$("#"+b+"-table tbody").empty().append(g.join(""));var n="";n+="<tr><td colspan="+k+2+">";if(cur_page>0){n+='<button class= "btn btn-success btn-md pull-left btn-prev table-button">Prev</button>'}else{n+='<button class= "btn btn-success btn-md pull-left disabled table-button">Prev</button>'}var j=parseInt(cur_page)+1;n+="Page "+j;if(cur_page<parseInt(p/rows_per_page)){n+='<button class= "btn btn-success btn-md pull-right btn-next">Next</button>'}else{n+='<button class= "btn btn-success btn-md pull-right disabled">Next</button>'}n+="<br/>"+p+" records";n+="</td></tr>";$("#"+b+"-table tfoot").empty().append(n);$(".btn-prev").on("click",function(l){l.preventDefault();setCookie("cur_page",cur_page-1);adm_load_table(b,a)});$(".btn-next").on("click",function(l){l.preventDefault();setCookie("cur_page",cur_page+1);adm_load_table(b,a)})}})};adm_edit_item=function(a,b){$("#item_id").val(a);fillForm(a,b)};fillForm=function(a,b){var c={};c.action="get_table_record";c.table=b;c.item_id=a;log("get_table_record",c);$.ajax({data:c,success:function(f){log("get_table_record",f);$this=f[0];for(var e in $this){if(e=="image"||e=="logo"){if($this[e].length>0){$("#"+e).attr("src","/img/"+$this[e])}else{$("#"+e).attr("src","/img/no-image.jpg")}}else{$("#"+e).val($this[e])}}if(b=="shop_product"){$(".selectpicker").prop("disabled",true);$("#availability").prop("disabled",false)}$(".selectpicker").selectpicker("refresh");$("."+b+"-list").addClass("hidden");$("."+b+"-form").removeClass("hidden")}})};var adm_delete_item=function(a,b){var c={};c.action="delete_table_record";c.table=b;c.item_id=a;log("get_table_data",c);$.ajax({data:c,success:function(e){log("adm_delete_item",e);if(e[0].error!=0){showErr(e[0].message)}else{adm_load_table(b)}}})};var saveData=function(a){var e=a+"_save";var b=a+"-form";var c={};c.action=e;$("#"+b).find(":input:not(button):not(reset)").each(function(){var f=$(this);if(f.attr("id")){c[f.attr("id")]=f.val().trim()}});log("saveData",c);$.ajax({data:c,success:function(f){log("saveData",f);if(f[0].error!=0){showErr(f[0].message)}else{showMsg(f[0].message);setCookie("record_id",f[0].record_id);$("."+a+"-list").removeClass("hidden");$("."+a+"-form").addClass("hidden");adm_load_table(a)}}})};