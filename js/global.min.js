var webservice_path="/ws/br.php",record_id,cur_page=0,token="",error=false,intro=false,HOME="/home.html",sms_url="https://www.bulksmsnigeria.net/components/com_spc/smsapi.php",sms_user="nwabuezestephen27@gmail.com",sms_password="Foot27ball",sms_sender="iyabasira",received_alerts="";load_products=function(){if(token.length==0){get_token()}$(".area-message").addClass("hidden");var a={};a.action="products_search";a.search=$("#search_text").val();a.token=cookies.getCookie("token");a.shop_area_id=cookies.getCookie("shop-area-id");log("load_products",a);$(".alert").hide();$.ajax({data:a,success:function(g){log("load_products",g);if(g[0].error==1){$("#dashboard-table").empty();showErr(g[0].message);return false}var b=g.length;var e=[],d=0;var f="-total_rows-";for(r=0;r<b;r++){$this=g[r];e[d]="<div class='list-group'>";d++;for(var c in $this){if(f.indexOf("-"+c+"-")==-1){e[d]="<div href='#' class='list-group-item it-"+$this.id+"'>";if($this.logo!=""){e[d]+="<img src='"+$this.logo+"' class='shop-logo'>"}else{e[d]+="<img class='shop-logo' src='/img/no-image.jpg'>"}e[d]+="<span class='area'>"+$this.area+"</span>";e[d]+="<span class='product'>"+$this.product+"</span><br/>";if($this.image==""){e[d]+="<img class='product-image' src='/img/no-image.jpg'>"}else{e[d]+="<img class='product-image' src='"+$this.image+"'>"}e[d]+="<span class='price'>"+$this.price+"</span>";e[d]+="<button class='buy-product-button btn btn-success btn-lg btn-order-now' onclick=buy_product("+$this.id+") >ORDER NOW</button>";e[d]+="</div>"}}e[d]+="</div>";d++}$("#dashboard-table").empty().append(e.join("")).show();$(".table-responsive").show();$(".search-box").show();if(navigator.geolocation){navigator.geolocation.getCurrentPosition(function(h){var i={lat:h.coords.latitude,lng:h.coords.longitude};save_location(i)})}}})};get_token=function(){if(cookies.getCookie("token")){token=cookies.getCookie("token");$("#token").val(token);return}var a={};a.action="get_token";a.area_id=cookies.getCookie("chosen-area");log("get_token",a);$.ajax({data:a,success:function(b){log("get_token",b);token=b[0].token;$("#token").val(token);cookies.setCookie("token",token)}})};buy_product=function(b){var a="it-"+b;var c=$("."+a).position();$("#quantity").val(1);$(".order-form").css("top",c.top+32).show();$(".order-form #shop_product_id").val(b);$(".shadow").show();event.preventDefault()};add_product=function(){var a={};a.action="save_item";a.token=token;a.shop_product_id=$("#shop_product_id").val();a.quantity=$("#quantity").val();log("add_product",a);$.ajax({data:a,success:function(c){log("add_product",c);var b=c[0];if(b.error==0){$(".order-form").hide();$(".shadow").hide()}else{if(b.error==2){resetToken()}$(".error_message").html(b.message).show()}updateBasket();load_products()}})};updateBasket=function(){var a={};a.action="get_total_basket";a.token=cookies.getCookie("token");log("updateBasket",a);$.ajax({data:a,success:function(d){log("updateBasket",d);var c=d[0];var b=c.grand_total;$(".basket").html(b);cookies.setCookie("total_basket",c.total_basket);cookies.setCookie("total_fees",c.total_fees);cookies.setCookie("delivery_fees",c.delivery_fees);cookies.setCookie("grand_total",c.grand_total);if(parseFloat(b)>0){$(".basket").parent().removeClass("hidden");$(".alerts-button").css({right:"150px"})}else{$(".basket").parent().addClass("hidden");$(".alerts-button").css({right:"0px"})}}})};load_basket_products=function(){var a={};user_id=0;a.action="basket_list";a.token=cookies.getCookie("token");log("load_basket_products",a);updateBasket();$.ajax({data:a,success:function(g){log("load_basket_products",g);if(g[0].error==1){$("#content").load(HOME);return}var e=[],h=[],d=0;var f="-id-area-";h[d]="<tr>";$this=g[0];for(var c in $this){if(f.indexOf("-"+c+"-")==-1){h[d]="<th class='__"+c+"'>"+c+"</th>";d++}}h[d]="</tr>";d=0;var b=g.length;for(r=0;r<b;r++){$this=g[r];e[d]="<tr>";d++;for(var c in $this){if(f.indexOf("-"+c+"-")==-1){if(c=="shop"){e[d]="<td class='__"+c+"'>"+$this[c]+"<br>"+$this.area+"</td>"}else{e[d]="<td class='__"+c+"'>"+$this[c]+"</td>"}d++}}e[d]="<td><a href='#' onclick=removeItem("+$this.id+")><span class='glyphicon glyphicon-remove'></span></td></a></tr>";d++}$("#basket-table thead").empty().append(h.join(""));$("#basket-table tbody").empty().append(e.join(""));d=0;e.length=0;e[d]="<tr><td colspan=3  class='_amount _top_line'>TOTAL BASKET</td><td class='_amount _top_line'>"+cookies.getCookie("total_basket")+"</td><td  class='_top_line'></td></tr>";d++;e[d]="<tr><td colspan=3  class='_amount'>DELIVERY</td><td class='_amount'>"+cookies.getCookie("delivery_fees")+"</td><td></td></tr>";d++;e[d]="<tr><td colspan=3  class='_amount _grand_total'>TOTAL ORDER</td><td class='_amount  _grand_total'>"+cookies.getCookie("grand_total")+"</td><td class='_amount  _grand_total'></td></tr>";$("#basket-table tfoot").empty().append(e.join(""));$(".table-responsive").show()}})};removeItem=function(a){var b={};b.action="remove_item";b.item_id=a;log("removeItem",b);$.ajax({data:b,success:function(c){log("removeItem",c);load_basket_products()}})};removeAll=function(){var a={};a.action="remove_all";a.token=cookies.getCookie("token");log("removeAll",a);$.ajax({data:a,success:function(b){log("removeAll",b);load_basket_products()}})};resetToken=function(){token="";$("#token").val(token);cookies.deleteAllCookies();get_token()};get_areas=function(){var a={};a.action="get_areas";log("get_areas",a);$.ajax({data:a,success:function(b){log("get_areas",b);$(".areas-list").html(b[0].areas)}})};save_location=function(b){var a={};a.action="save_location";a.token=cookies.getCookie("token");a.lat=b.lat;a.lng=b.lng;log("save_location",a);$.ajax({data:a,success:function(c){log("save_location",c)},error:function(c){log("save_location.error",c)}})};load_dropdown=function(a,d,b){d=(typeof d==="undefined")?false:d;b=(typeof b==="undefined")?false:b;var c={};c.action=a+"_list";log("load_"+a,c);var e="Nothing selected";switch(a){case"areas":e="Select an area";break;case"category":e="Select a category";break}$.ajax({data:c,success:function(i){log("load_"+a,i);var h=[];var f=i.length;if(d==1){var g="<option></option>"}for(r=0;r<f;r++){$this=i[r];h[r]=g+"<option value="+$this.id+">"+$this.value+"</option>";g=""}$("."+a).html(h.join("")).selectpicker({noneSelectedText:e}).selectpicker("refresh");if(b){$("."+a).prop("disabled",true);$("."+a).selectpicker("refresh")}}})};validate_form=function(d){$(".alert").hide();var a=d.length;var b="";error=false;for(var c=0;c<a;c++){b=d[c].name;if(b!=""){validate_field(b)}}if(error){showErr("Some errors were found. Please correct them in the form and try again")}else{submitForm($(d).attr("id").replace("-form",""))}};validate_field=function(b){var a="#"+b;var c="#"+b+"1";if($(a).val()==""&&$(a).attr("isRequired")=="isRequired"){$(a).closest(".form-group").removeClass("has-success has-feedback").addClass("has-error has-feedback");$(c).removeClass("glyphicon-ok").addClass("glyphicon-remove");error=true}else{$(a).closest(".form-group").removeClass("has-error has-feedback").addClass("has-success has-feedback");$(c).removeClass("glyphicon-remove").addClass("glyphicon-ok")}};var submitForm=function(a){var d=a+"_save";var b=a+"-form";var c={};c.action=d;c.token=cookies.getCookie("token");c.area_id=cookies.getCookie("chosen-area");$("#"+b).find(":input:not(button):not(reset)").each(function(){var e=$(this);if(e.attr("id")){c[e.attr("id")]=e.val().trim().toUpperCase()}});log("submitForm",c);$.ajax({data:c,success:function(e){log("submitForm",e);if(e[0].error!=0){showErr(e[0].message)}else{showMsg(e[0].message);cookies.setCookie("order_id",e[0].order_id);notify(e[0].order_id);updateBasket();$("#content").load("/thanks")}}})};notify=function(b){var a={};a.action="order_notify";a.order_id=b;log("notify",a);$.ajax({data:a,success:function(c){log("notify",c)}})};get_config_value=function(a){var b={};b.action="get_config_value";b.name=a;log("get_config_value",b);$.ajax({data:b,dataType:"json",success:function(c){log("get_config_value",c);cookies.setCookie(a,c[0].value)}})};fillForm=function(a,b){var c={};c.action="get_table_record";c.table=b;c.item_id=a;log("get_table_record",c);$.ajax({data:c,success:function(e){log("get_table_record",e);$this=e[0];for(var d in $this){if(d=="image"){if($this[d].length>0){$("#"+d).attr("src",$this[d])}else{$("#"+d).attr("src","/img/no-image.jpg")}}else{$("#"+d).val($this[d])}}if(b=="shop_product"){$(".selectpicker").prop("disabled",true);$("#availability").prop("disabled",false)}$(".selectpicker").selectpicker("refresh");$("."+b+"-list").addClass("hidden");$("."+b+"-form").removeClass("hidden")}})};load_shops_areas=function(){var a={};a.action="get_shops_areas";a.area_id=cookies.getCookie("chosen-area");log("get_shops_areas",a);$.ajax({data:a,success:function(g){log("get_shops_areas",g);var b=g.length;if(b==1&&g[0].error){return}var e=[],d=0;var f="-id-";d=0;for(r=0;r<b;r++){$this=g[r];d++;for(var c in $this){if(f.indexOf("-"+c+"-")==-1){e[d]="<button class='btn btn-success btn-lg btn-shop form-control' onclick='select_shop_area("+$this.id+")'>"+$this[c]+"</button>";d++}}d++}$("#shops-table").empty().append(e.join(""));$(".shops-container").show()}})};updateBasket();store_values=function(){var a=$("form :input");a.each(function(){cookies.setCookie(this.id,$(this).val())})};restore_values=function(){var a=$("form :input");a.each(function(){$("#"+this.id).val(cookies.getCookie(this.id))})};