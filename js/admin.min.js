window.onerror=function(c,a,b){log("JavaScript error: "+c+" on line "+b+" for "+a)};var col_names=[];var d="d="+new Date().toJSON();var webservice_path="/ws/br.php",record_id,cur_page=0;error=false,$.ajaxSetup({type:"GET",url:webservice_path,contentType:"application/json; charset=utf-8",dataType:"json",cache:true,async:true,timeout:0,error:function(b,a){log_ajax_error(b,a)}});$(document).ajaxStart(function(){$(".fa").show().center()});$(document).ajaxStop(function(){$(".fa").fadeOut("slow")});$(document).ajaxError(function(){setTimeout(function(){$(".fa").fadeOut("slow")},3000)});log_ajax_error=function(b,a){log(b);showErr("We are sorry, but there was an error accessing the database")};var log=function(a,b){console.debug(a,b)};jQuery.fn.center=function(){this.css("position","absolute");this.css("top",Math.max(0,(($(window).height()-$(this).outerHeight())/3)+$(window).scrollTop())+"px");this.css("left",Math.max(0,(($(window).width()-$(this).outerWidth())/2)+$(window).scrollLeft())+"px");return this};showMsg=function(a){$(".alert").removeClass("alert-danger").removeClass("alert-info").addClass("alert-info");$(".alert #msg").html(a);$(".alert").show()};showErr=function(a){$(".alert").removeClass("alert-info").removeClass("alert-danger").addClass("alert-danger");$(".alert #msg").html(a);$(".alert").show()};var login=function(){var a={};a.action="login";$("#login").find(":input:not(button):not(reset)").each(function(){var b=$(this);if(b.attr("id")){a[b.attr("id")]=b.val().trim()}});log("login",a);$.ajax({data:a,success:function(b){log("login",b);if(b[0].user_id){document.getElementById("id01").style.display="none";$(".navbar").removeClass("hidden");$this=b[0];for(key in $this){setCookie(key,$this[key])}setCookie("login",1)}else{showErr("Email or password incorrect");setCookie("login",0)}}})};var saveData=function(a){var e=a+"_save";var b=a+"-form";var c={};c.action=e;$("#"+b).find(":input:not(button):not(reset)").each(function(){var f=$(this);if(f.attr("id")){c[f.attr("id")]=f.val().trim()}});log("saveData",c);$.ajax({data:c,success:function(f){log("saveData",f);if(f[0].error!=0){showErr(f[0].message)}else{showMsg(f[0].message);setCookie("record_id",f[0].record_id);$("."+a+"-list").removeClass("hidden");$("."+a+"-form").addClass("hidden");adm_load_table(a)}}})};var adm_delete_item=function(e,f){if(e==undefined){return false}record_id=e;var c="";var b=0;var a=col_names.length;$(".tr_"+e).find("td").each(function(){if(b<a){if($(this).html().length>0){c+="<div class='delete-data'>"+col_names[b]+": <span class='data'>"+$(this).html()+"</span></div>"}}b++});setCookie("item_id",e);setCookie("table",f);$("#confirm-body").html(c);$("#delete-confirmation").modal("show")};var commit_details_confirmed=function(){var a={};a.action="delete_table_record";a.table=getCookie("table");a.item_id=getCookie("item_id");log("get_table_data",a);$.ajax({data:a,success:function(b){log("adm_delete_item",b);if(b[0].error!=0){showErr(b[0].message)}else{$("#delete-confirmation").modal("hide");setTimeout(function(){adm_load_table(getCookie("table"))},1000)}}})};var adm_load_table=function(b,a){a=(typeof a==="undefined")?false:a;$(".table-name").html(b.replace("_"," / "));$(".alert").hide();if(getCookie("cur_page")){cur_page=parseInt(getCookie("cur_page"))}if(getCookie("rows_per_page")){rows_per_page=parseInt(getCookie("rows_per_page"))}var c={};c.action="adm_load_table_"+b;c.search=$("#search").val();c.limit=cur_page;c.rows=rows_per_page;log("load_table",c);$.ajax({data:c,success:function(f){log("load_table",f);if(f[0].error==1){$("#"+b+"-table tbody").empty();$("#"+b+"-table tbody").empty();$("#"+b+"-table tfood").empty();showErr(f[0].message);return false}var m="-id-active-status_name-total_records-";var e=f.length;var k=0;var g=[],h=0;$this=f[0];var q=$this.total_records;g[h]="<tr>";h++;col_names.length=0;for(var p in $this){if(m.indexOf("-"+p+"-")==-1){col_names[k]=p;g[h]="<th class='__"+p.replace(" ","_")+"'>"+p.replace("_"," ")+"</th>";h++;k++}}if(!a){g[h]="<th></th>";h++;k++}g[h]="</tr>";$("#"+b+"-table thead").empty().append(g.join(""));g=[];h=0;for(r=0;r<e;r++){$this=f[r];g[h]="<tr class='tr_"+$this.id+"'>";h++;for(var p in $this){if(m.indexOf("-"+p+"-")==-1){switch(p){case"status":case"is_active":g[h]="<td class='__"+p.replace(" ","_")+"'><img class='__"+p.replace(" ","_")+"' src='"+$this[p]+"'></td>";break;case"notify":g[h]="<td class='__"+p.replace(" ","_")+"'><img class='__"+p.replace(" ","_")+"' title='"+$this.status_name+"' src='"+$this[p]+"'></td>";break;case"image":g[h]="<td class='__"+p.replace(" ","_")+"'><img class='__"+p.replace(" ","_")+"' src='"+$this[p]+"'></td>";break;default:g[h]="<td class='__"+p.replace(" ","_")+"'>"+$this[p]+"</td>"}h++}}if(!a){g[h]='<td class="button-group">';h++;if($this.active==0){g[h]='<button class="btn btn-danger btn-sm delete-item" onclick="adm_delete_item('+$this.id+",'"+b+"')\">Delete</button>";h++}g[h]='<button class="btn btn-primary btn-sm edit-item" onclick="adm_edit_item('+$this.id+",'"+b+"')\">Edit</button>";h++;g[h]="</td>";h++}g[h]="</tr>";h++}$("#"+b+"-table tbody").empty().append(g.join(""));var o="";var n=parseInt(k);o+="<tr><td colspan="+n+">";if(cur_page>0){o+='<button class= "btn btn-success btn-md pull-left btn-prev table-button">Prev</button>'}else{o+='<button class= "btn btn-success btn-md pull-left disabled table-button">Prev</button>'}var j=parseInt(cur_page)+1;o+="Page "+j;if(cur_page<parseInt(q/rows_per_page)){o+='<button class= "btn btn-success btn-md pull-right btn-next">Next</button>'}else{o+='<button class= "btn btn-success btn-md pull-right disabled">Next</button>'}o+="<br/>"+q+" records";o+="</td></tr>";$("#"+b+"-table tfoot").empty().append(o);$(".btn-prev").on("click",function(l){l.preventDefault();setCookie("cur_page",cur_page-1);adm_load_table(b,a)});$(".btn-next").on("click",function(l){l.preventDefault();setCookie("cur_page",cur_page+1);adm_load_table(b,a)})}})};var adm_edit_item=function(a,b){$("#item_id").val(a);fillForm(a,b)};var remove_markers=function(){for(i=0;i<markers.length;i++){markers[i].setMap(null)}};var close_infowindows=function(){for(i=0;i<infowindows.length;i++){infowindows[i].close()}};var relocateMap=function(){if(navigator.geolocation){navigator.geolocation.getCurrentPosition(function(a){lat=a.coords.latitude;lng=a.coords.longitude;initialLocation=new google.maps.LatLng(a.coords.latitude,a.coords.longitude);me_marker.setPosition(initialLocation)})}};var fillForm=function(a,b){var c={};c.action="get_table_record";c.table=b;c.item_id=a;log("get_table_record",c);$.ajax({data:c,success:function(f){log("get_table_record",f);$this=f[0];for(var e in $this){if(e=="image"){if($this[e].length>0){$("#"+e).attr("src",$this[e])}else{$("#"+e).attr("src","/img/no-image.jpg")}}else{$("#"+e).val($this[e])}log(e,$this[e])}if(b=="shop_product"){$(".selectpicker").prop("disabled",true);$("#availability").prop("disabled",false)}$(".selectpicker").selectpicker("refresh");$("."+b+"-list").addClass("hidden");$("."+b+"-form").removeClass("hidden")}})};load_dropdown=function(a,e,b){e=(typeof e==="undefined")?false:e;b=(typeof b==="undefined")?false:b;var c={};c.action=a+"_list";log("load_"+a,c);var f="Nothing selected";switch(a){case"areas":f="Select an area";break;case"category":f="Select a category";break}$.ajax({data:c,success:function(k){log("load_"+a,k);var j=[];var g=k.length;if(e==1){var h="<option></option>"}for(r=0;r<g;r++){$this=k[r];j[r]=h+"<option value="+$this.id+">"+$this.value+"</option>";h=""}$("."+a).html(j.join("")).selectpicker({noneSelectedText:f}).selectpicker("refresh");if(b){$("."+a).prop("disabled",true);$("."+a).selectpicker("refresh")}}})};var get_latest_messages=function(){var a={};a.action="get_latest_messages";log("send_message",a);$.ajax({data:a,success:function(f){log("get_latest_messages",f);if(f.length>0&&!f[0].error){var c=[];var b=0;c[b]='<ul class="nav nav-tabs">';b++;for(var e=0;e<f.length;e++){$this=f[e];c[b]='<li class="message-option"><a href="javascript:void(0)" onclick="open_chat_room('+$this.order_id+')">'+$this.number+'<br><span class="message-sent">'+$this.sent+"</span></a></li>";b++}c[b]="</ul>";$(".data").empty().append(c.join(""));setTimeout(function(){get_latest_messages()},30000)}}})};